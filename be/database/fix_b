-- Fix burial service table to use pastor_name instead of pastor_id
-- This matches the frontend and backend code expectations

-- Check if pastor_name column already exists
SELECT COLUMN_NAME 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_SCHEMA = DATABASE() 
  AND TABLE_NAME = 'tbl_burialservice' 
  AND COLUMN_NAME = 'pastor_name';

-- If pastor_name doesn't exist, rename pastor_id to pastor_name
-- First check if pastor_id exists
SELECT COLUMN_NAME 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_SCHEMA = DATABASE() 
  AND TABLE_NAME = 'tbl_burialservice' 
  AND COLUMN_NAME = 'pastor_id';

-- Rename pastor_id to pastor_name if pastor_id exists
ALTER TABLE `tbl_burialservice`
  CHANGE COLUMN `pastor_id` `pastor_name` VARCHAR(45) NULL;

-- Verify the column was renamed
SELECT COLUMN_NAME, DATA_TYPE, IS_NULLABLE, COLUMN_DEFAULT
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_SCHEMA = DATABASE() 
  AND TABLE_NAME = 'tbl_burialservice' 
ORDER BY ORDINAL_POSITION;

-- Also ensure deceased_birthdate and date_death are properly typed
-- The schema shows them as DATE but they might need to be adjusted
ALTER TABLE `tbl_burialservice`
  MODIFY COLUMN `deceased_birthdate` DATE NULL,
  MODIFY COLUMN `date_death` DATETIME NULL;

-- Verify all columns
SELECT COLUMN_NAME, DATA_TYPE, IS_NULLABLE, COLUMN_DEFAULT
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_SCHEMA = DATABASE() 
  AND TABLE_NAME = 'tbl_burialservice' 
ORDER BY ORDINAL_POSITION;
